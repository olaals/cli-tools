#!/bin/bash

# clip_recursive.sh
# Usage: ./clip_recursive.sh [--tree] filename1.txt dir1/ filename2.txt ...

final_content=""
include_tree=false

# Handle optional --tree flag
if [ "$1" == "--tree" ]; then
	include_tree=true
	shift 1
fi

# Check for minimum number of arguments
if [ "$#" -lt 1 ]; then
	echo "Usage: $0 [--tree] filename1.txt dir1/ filename2.txt ..."
	exit 1
fi

# If --tree flag is present, add the output of `tree` to final_content
if [ "$include_tree" = true ]; then
	final_content+="== File Tree ==\n"
	final_content+="$(tree)\n\n"
fi

# Recursive function to read a file or directory
process_item() {
	local item=$1
	if [ -f "$item" ]; then
		final_content+="== $item ==\n"
		final_content+="$(cat "$item")\n\n"
	elif [ -d "$item" ]; then
		for sub_item in "$item"/*; do
			process_item "$sub_item"
		done
	else
		echo "Item $item does not exist."
		exit 1
	fi
}

# Loop through all arguments
for item in "$@"; do
	process_item "$item"
done

# Copy the final_content to clipboard
echo -e "$final_content" | pbcopy

echo "Contents of files and directories copied to clipboard."
